<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../things-global-behavior/things-global-behavior.html">
<link rel="import" href="../things-msg-box-behavior/things-msg-box-behavior.html">

<link rel="import" href="../things-meta/things-diy-form-meta-behavior.html">

<script>

window.Things = window.Things || {};

/**
 * 리소스 타입 DiyForm 기반 폼 화면 Behavior
 *
 * @polymerBehavior Things.DiyBasedFormBehavior
 */
Things.DiyBasedFormBehaviorImpl = {

	properties: {
		/**
		 * 조회 결과 
		 */
		diyForm: {
			type: Object,
			observer: '_diyFormChanged'
		},

		/**
		 * 폼 컬럼 개 
		 */
		columnCount: {
			type: Number,
			value: 1
		},

		/**
		 * 폼 데이터 
		 */
		resource: {
			type: Array
		}
	},

	/**
	 * Form을 리턴한다.
	 */
	getForm: function() {
		return this.$.form;
	},

	/**
	 * Form 데이터를 serialize하여 리턴 
	 */
	serializeMyForm: function() {
		return this.getForm().serializeMyForm();
	},

	/**
	 * Form 데이터를 reset 
	 */
	resetMyForm: function() {
		this.getForm().resetMyForm();
	},

	/**
	 * Form 데이터 설정 
	 */
	setFormData: function(data) {
		this.getForm().setFormData(data);
	},

	/**
	 * Focus를 설정한다.
	 */
	focus: function() {
		this.getForm().focus();
	},

	/**
	 * 모든 Form Element를 리턴 
	 */
	getFormElements: function() {
		return this.getForm().getFormElements();
	},

	/**
	 * Validation check before save. 
	 * 필드들의 isValid 속성을 통해 valdation 체크를 수행
	 */
	validationCheck: function() {
		return this.getForm().validationCheck();
	},

	/**
	 * Submit form
	 *
	 * @param {Object} e 버튼 클릭 이벤트 
	 */
	submitMyForm: function(e) {
		this.getForm().submitMyForm();
	}
			
	/**
	 * 그리드 데이터를 초기화 
	 */
	resetData: function() {
		this.getForm().resetMyForm();
	},

	/**
	 * 그리드 데이터를 리프레쉬  
	 */
	refreshData: function(data) {
		this.getForm().setFormData(data);
	},

	/**
	 * ID Field를 리턴한다.
	 */
	getIdField: function() {
		return (this.diyForm && this.diyForm.id_field) ? this.diyForm.id_field : 'id';
	},

	/**
	 * Title Field를 리턴한다.
	 */
	getTitleField: function() {
		return (this.diyForm && this.diyForm.title_field) ? this.diyForm.title_field : 'name';
	},

	/**
	 * 메뉴 메타데이터 변경시
   *
	 * @param {Object} diyForm
	 */
	_diyFormChanged: function(diyForm) {
		if(diyForm) {
			this.diyFormId = diyForm.id;
			this.columnCount = diyForm.columns_per_row;
		}
	}
};

Things.DiyBasedFormBehavior = [
	Things.DiyBasedFormBehaviorImpl,
	Things.DiyFormMetaBehavior,
	Things.MsgBoxBehavior,
	Things.GlobalBehavior
];

</script>